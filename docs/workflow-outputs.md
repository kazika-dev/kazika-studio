# ワークフロー出力タイプ

このドキュメントでは、各ワークフローがどのような出力を生成するかについて説明します。

## 出力タイプの種類

### 🖼️ 画像 (Image)
画像データを出力するワークフローです。

**出力形式:**
```typescript
{
  imageData: {
    mimeType: string;  // 例: "image/png", "image/jpeg"
    data: string;      // Base64エンコードされた画像データ
  },
  imageUrl?: string;   // オプション: 画像のURL
}
```

**対応ノードタイプ:**
- `geminiVision` - Gemini Vision API
- `nanobanaImageGen` - Nanobana画像生成
- `imageInput` - 画像入力ノード
- `imageGen` - 汎用画像生成

**用途:**
- 画像生成AI
- 画像編集・変換
- 画像分析の視覚化

---

### 🎬 動画 (Video)
動画データを出力するワークフローです。

**出力形式:**
```typescript
{
  videoUrl: string;  // 動画ファイルのURL
  duration?: number; // 再生時間（秒）
}
```

**対応ノードタイプ:**
- `videoGen` - 汎用動画生成
- `nanobanaVideoGen` - Nanobana動画生成

**用途:**
- 動画生成AI
- アニメーション作成
- ビデオ編集

---

### 🎵 音声 (Audio)
音声データを出力するワークフローです。

**出力形式:**
```typescript
{
  audioUrl?: string;  // 音声ファイルのURL
  audioData?: string; // Base64エンコードされた音声データ
  duration?: number;  // 再生時間（秒）
}
```

**対応ノードタイプ:**
- `audioGen` - 汎用音声生成
- `textToSpeech` / `tts` - テキスト読み上げ

**用途:**
- 音声合成
- テキスト読み上げ
- BGM生成

---

### 📝 テキスト (Text)
テキストデータを出力するワークフローです。

**出力形式:**
```typescript
{
  response?: string;  // AI応答テキスト
  text?: string;      // テキストデータ
  value?: string;     // 値
}
```

**対応ノードタイプ:**
- `gemini` - Gemini API
- `claude` - Claude API
- `openai` - OpenAI API
- `textGen` - 汎用テキスト生成
- `input` - テキスト入力ノード

**用途:**
- テキスト生成AI
- 自然言語処理
- プロンプト入力

---

## ワークフローステップでの出力の使用

### 前のステップの出力を使用する

ワークフローステップを追加する際、前のステップの出力を次のステップの入力として使用できます。

**設定方法:**
1. ワークフローステップ追加ダイアログで「追加設定」セクションを開く
2. 「前のステップの出力を使用」で必要な出力タイプにチェックを入れる
   - ✅ 画像
   - ✅ 動画
   - ✅ 音声
   - ✅ テキスト

**例: 画像生成 → 画像編集**
```
ステップ1: 画像生成ワークフロー
  ├─ 出力: 画像データ

ステップ2: 画像編集ワークフロー
  ├─ 入力設定:
  │   └─ 前のステップの出力を使用: ✅ 画像
  └─ 前のステップで生成された画像を自動的に使用
```

---

## 複数出力タイプ

一部のワークフローは複数の出力タイプを持つことがあります。

**例:**
- 画像 + テキスト: 画像生成と説明文を同時に出力
- 動画 + 音声: 動画に音声トラックを含める
- テキスト + 画像: 記事と挿絵を生成

複数出力を持つワークフローでは、出力タイプのチップが複数表示されます。

---

## ワークフロー入力の設定

各ワークフローには、そのワークフローに固有の入力フィールドが定義されています（`form_config`）。

### 入力フィールドタイプ

1. **text** - 単一行テキスト
2. **textarea** - 複数行テキスト
3. **prompt** - プロンプト入力（複数行、プレースホルダー付き）
4. **image** - 単一画像アップロード
5. **images** - 複数画像アップロード

### 入力値の保存

ワークフローステップに入力した値は、`input_config.workflowInputs` に保存されます。

```typescript
{
  workflowInputs: {
    "prompt": "青い空と白い雲",
    "aspectRatio": "16:9",
    "image": {
      mimeType: "image/jpeg",
      data: "base64..."
    }
  }
}
```

---

## ベストプラクティス

### 1. 出力タイプを確認する
ワークフローを選択すると、「このワークフローの出力」セクションに出力タイプが表示されます。次のステップで必要な入力タイプと一致することを確認しましょう。

### 2. 必須フィールドを入力する
赤い `*` マークがついているフィールドは必須です。すべて入力しないとステップを追加できません。

### 3. 前のステップの出力を活用する
連続処理が必要な場合は、「前のステップの出力を使用」を活用して、データを自動的に引き継ぎましょう。

### 4. プロンプトは明確に
テキスト入力やプロンプトフィールドでは、できるだけ具体的で明確な指示を書くことで、より良い結果が得られます。

---

## トラブルシューティング

### 出力が表示されない
- ワークフローが正常に完了しているか確認してください
- ステップの状態が「完了」になっているか確認してください
- エラーメッセージが表示されていないか確認してください

### 前のステップの出力が使用されない
- 前のステップが「完了」状態になっているか確認してください
- 正しい出力タイプを選択しているか確認してください
- 前のステップが実際にその出力タイプを生成しているか確認してください

### 必須フィールドのエラー
- すべての必須フィールド（`*` マーク付き）を入力してください
- 画像フィールドの場合、最低1枚の画像をアップロードしてください
- テキストフィールドは空欄にできません

---

## 関連ファイル

- `/components/studio/AddWorkflowStepDialog.tsx` - ワークフローステップ追加ダイアログ
- `/components/studio/WorkflowStepCard.tsx` - ワークフローステップカード
- `/components/form/DynamicFormField.tsx` - 動的フォームフィールド
- `/lib/db.ts` - データベース操作関数
